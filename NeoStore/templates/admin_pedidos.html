<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Pedidos | NeoBux</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <header>
    <div class="banner-container">
      <h1 class="site-name">NeoBux Admin</h1>
      <nav>
        <ul>
          <li><a href="{{ url_for('homepage') }}">Voltar ao Site</a></li>
          <li><a href="{{ url_for('admin_pedidos') }}">Pedidos</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="hero">
        <h1>Painel Administrativo</h1>
        <p>Gerencie pedidos e status de entrega</p>
      </div>

      <div style="background: var(--bg-primary); border-radius: var(--radius-xl); padding: 2rem; margin: 2rem 0; box-shadow: var(--shadow-lg);">
        <h2 style="margin-bottom: 1.5rem; color: var(--text-primary);">Lista de Pedidos</h2>
        
        {% if pedidos %}
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
              <thead>
                <tr style="background: var(--bg-secondary);">
                  <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color);">ID</th>
                  <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color);">Cliente</th>
                  <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color);">Produto</th>
                  <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color);">Valor</th>
                  <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color);">Data</th>
                  <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color);">Status</th>
                  <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color);">Ações</th>
                </tr>
              </thead>
              <tbody>
                {% for pedido in pedidos %}
                <tr style="border-bottom: 1px solid var(--border-color);">
                  <td style="padding: 1rem;">#{{ pedido.id }}</td>
                  <td style="padding: 1rem;">
                    <div>
                      <strong>{{ pedido.nome_comprador }}</strong><br>
                      <small style="color: var(--text-secondary);">{{ pedido.nick_roblox }}</small><br>
                      <small style="color: var(--text-secondary);">{{ pedido.email_comprador }}</small>
                    </div>
                  </td>
                  <td style="padding: 1rem;">
                    <div>
                      <strong>{{ pedido.produto.nome }}</strong><br>
                      <small style="color: var(--text-secondary);">{{ pedido.produto.quantidade }} Robux</small>
                    </div>
                  </td>
                  <td style="padding: 1rem;">
                    <strong style="color: var(--success-color);">R$ {{ "%.2f"|format(pedido.produto.preco) }}</strong>
                  </td>
                  <td style="padding: 1rem;">
                    <small>{{ pedido.data_pedido.strftime('%d/%m/%Y %H:%M') }}</small>
                  </td>
                  <td style="padding: 1rem;">
                    <span class="status status-{{ pedido.status }}">
                      {{ pedido.status.title() }}
                    </span>
                  </td>
                  <td style="padding: 1rem;">
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                      <form method="POST" action="{{ url_for('atualizar_status_pedido', pedido_id=pedido.id) }}" style="display: inline;">
                        <select name="status" onchange="this.form.submit()" style="padding: 0.25rem; border-radius: var(--radius-sm); border: 1px solid var(--border-color);">
                          <option value="pendente" {% if pedido.status == 'pendente' %}selected{% endif %}>Pendente</option>
                          <option value="verificado" {% if pedido.status == 'verificado' %}selected{% endif %}>Verificado</option>
                          <option value="pago" {% if pedido.status == 'pago' %}selected{% endif %}>Pago</option>
                          <option value="entregue" {% if pedido.status == 'entregue' %}selected{% endif %}>Entregue</option>
                          <option value="cancelado" {% if pedido.status == 'cancelado' %}selected{% endif %}>Cancelado</option>
                        </select>
                      </form>
                      <a href="{{ url_for('ver_pedido', pedido_id=pedido.id) }}" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.875rem;">Ver</a>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
            <p style="font-size: 1.2rem;">Nenhum pedido encontrado.</p>
          </div>
        {% endif %}
      </div>

      <!-- Estatísticas -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 2rem 0;">
        <div style="background: var(--bg-primary); padding: 1.5rem; border-radius: var(--radius-lg); text-align: center; box-shadow: var(--shadow-md);">
          <h3 style="color: var(--primary-color); font-size: 2rem; margin-bottom: 0.5rem;">{{ pedidos|length }}</h3>
          <p style="color: var(--text-secondary);">Total de Pedidos</p>
        </div>
        <div style="background: var(--bg-primary); padding: 1.5rem; border-radius: var(--radius-lg); text-align: center; box-shadow: var(--shadow-md);">
          <h3 style="color: var(--warning-color); font-size: 2rem; margin-bottom: 0.5rem;">{{ pedidos|selectattr('status', 'equalto', 'pendente')|list|length }}</h3>
          <p style="color: var(--text-secondary);">Pendentes</p>
        </div>
        <div style="background: var(--bg-primary); padding: 1.5rem; border-radius: var(--radius-lg); text-align: center; box-shadow: var(--shadow-md);">
          <h3 style="color: var(--success-color); font-size: 2rem; margin-bottom: 0.5rem;">{{ pedidos|selectattr('status', 'equalto', 'entregue')|list|length }}</h3>
          <p style="color: var(--text-secondary);">Entregues</p>
        </div>
        <div style="background: var(--bg-primary); padding: 1.5rem; border-radius: var(--radius-lg); text-align: center; box-shadow: var(--shadow-md);">
          <h3 style="color: var(--success-color); font-size: 2rem; margin-bottom: 0.5rem;">R$ {{ "%.2f"|format(pedidos|sum(attribute='produto.preco')) }}</h3>
          <p style="color: var(--text-secondary);">Faturamento Total</p>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Auto-refresh da página a cada 30 segundos
    setTimeout(() => {
      location.reload();
    }, 30000);

    // Notificação de atualização de status
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('updated')) {
      showNotification('Status atualizado com sucesso!', 'success');
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
  </script>
</body>
</html>
